{# src/Bacloo/CrmBundle/Resources/views/Blog/search.html.twig #}
{% extends "BaclooCrmBundle::layout.html.twig" %}
{% block body %}
	<form id="sigform" class="form-horizontal" action="{{ path('bacloocrm_bondepart', {'bondepartid':bondepartid, 'codelocation':codelocation} ) }}" method="post" {{form_enctype(form) }}>
	<div class="panel panel-default">
		<div class="panel-heading">
			<h3 class="panel-title">
				<h3>Bon de départ pour la machine {{ machine.code }}</h3>
			</h3>
		</div>
		<div class="panel-body">
			<div class="form-group">
				<div class="col-md-12">
					<div class="form-group">
						<div class="col-md-12">
							<div class="input-group">
								<span class="input-group-addon"><b>Date</b></span>
								{{ form_widget(form.date, { 'attr' : { 'class' : 'form-control datepicker' } })  }}
							</div>
						</div>
					</div>
					<div class="form-group">
						<div class="col-md-12">
							<div class="input-group clockpicker">
								<span class="input-group-addon"><b>Heure de retour</b></span>
								{{ form_widget(form.heure, { 'name':'name', 'attr' : { 'class' : 'form-control' } })  }}
							</div>
						</div>
					</div>
					<table style="width:100%;">
						<tr>
							<td style="text-align: center;">
								<div class="form-group pull-left">
									<div class="col-md-12">
										<div class="input-group">
											<span><b>Clé</b></span>
											{{ form_widget(form.cle, {'attr' : { 'class' : 'form-control' } })  }}
										</div>
									</div>
								</div>
							</td>
							<td style="text-align: center;">
								<div class="form-group pull-right">
									<div class="col-md-12">
										<div class="input-group">
											<span><b>Documents</b></span>
											{{ form_widget(form.docadmin, { 'attr' : { 'class' : 'form-control' } })  }}
										</div>
									</div>
								</div>
							</td>
						</tr>
					</table>
					{% if machine.energie == 'diesel' %}
						<div class="form-group">
							<div class="col-md-12">
								<div class="input-group">
									<span class="input-group-addon"><b>Niveau de carburant</b></span>
									{{ form_widget(form.niveaucarb, {'attr' : { 'class' : 'form-control ' } })  }}
								</div>
							</div>
						</div>
					{% endif %}
					<div class="form-group">
						<div class="col-md-12">
							<div class="input-group">
								<span class="input-group-addon"><b>Horametre</b></span>
								{{ form_widget(form.horametre, {'attr' : { 'class' : 'form-control ' } })  }}
							</div>
						</div>
					</div>
					<div class="form-group">
						<div class="col-md-12">
							<div class="input-group">
								<span class="input-group-addon"><b>Commentaire</b></span>
								{{ form_widget(form.commentaire, {'attr' : { 'class' : 'form-control ' } })  }}
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		{% if bondepartid > 0 %}
			<div style="text-align:center"><a type="button" class="btn btn-success btn-xs" href="{{ path('bacloocrm_bondepartpdf', {'ficheid': machine.clientid, 'bdid': bondepartid, 'codecontrat': machine.codecontrat, 'codelocation': codelocation }) }}">Bon de départ</a></div><br>
			<div class="panel panel-default" id="modivc">
				<div class="panel-heading">
					<h3 class="panel-title">
						Liste des photos du bon de départ
					</h3>
				</div>
				<div class="panel-body">
					<div class="tab-content">
						<div class="form-group">
							<div class="col-sm-12">
								<center><div class="dropzone col-md-12" id="my-awesome-dropzone" style="border-style: dashed solid; height:50px;"><div class="dz-message" data-dz-message><span>Glissez un fichier ici ou cliquez</span></div></div></center>
							</div>
						</div>
					</div>
					<table class="table table-striped col-md-12">
						<thead>
						<th>
							Nom du fichier
						</th>
						<th>

						</th>
						<th>

						</th>
						</thead>
						{% for document in documents %}
							<tr>
								<td class="col-md-10">
									{{ document.nom }}
								</td>
								<td>
									<a type="button" class="btn btn-primary btn-xs" href="{{ asset('uploads/bd/'~ bondepartid ~'/' ~ document.nom ~ '') }}">Ouvrir</a>
								</td>
								<td class="col-md-10">
									<a type="button" class="btn btn-danger btn-xs" href="{{ path('bacloocrm_removedocument', {'iddoc': document.id, 'codecontrat':bondepartid, 'type':'bd' }) }}">Supprimer</a>
								</td>
							</tr>
						{% endfor %}
					</table>
				</div>
			</div>
		{% endif %}

		<center>
			<br>
			<input type="submit" class="btn btn-primary" value="Enregistrer le formulaire"/>
			<a class="btn btn-primary" href="{{ path('bacloocrm_adispatcher') }}"><span>Fermer</span></a>
			{{ form_row(form._token) }}
		</center>
		<br><br>
		{% if bondepartid > 0 %}
			{% if form.signed.vars.value is not empty %}
				<div class="panel panel-default col-md-4">
					<div class="panel-body">
						<img src="{{ form.signed.vars.value }}" />
						<div class="hidden">{{ form_widget(form.signed, {'id':"sigdataid", 'attr' : { 'class' : 'form-control' } })  }}</div>
					</div>
				</div>
				<div class="col-md-12">
					<input data-action="save-jpg" type="submit" class="btn btn-primary" value="Enregistrer"/>
					<a class="btn btn-info" href="{{ path('bacloocrm_voir', {'id': clientid}) }}"><span>Fermer</span></a>
				</div>
			{% else %}
				<div class="panel panel-default">
					<div class="panel-body">
						<div id="signature-pad" class="signature-pad">
							<div class="signature-pad--body">
								<canvas style="width:600px;height:200px;" ></canvas>
							</div>
							<div class="signature-pad--footer">
								<div class="description">Signez au dessus</div>

								<div class="signature-pad--actions">
									<div>
										<div class="hidden">
											<button type="button" class="button" data-action="change-color">Change color</button>
											<button type="button" class="button" data-action="undo">Undo</button>
											<button type="button" class="button save" data-action="save-svg">Save as SVG</button>
											<button type="button" class="button save" data-action="save-png">Save as PNG</button>
										</div>

									</div>
									<div>
{#										<button type="button" class="button save" data-action="save-jpg">Save as JPG</button>#}
										<button type="button" class="button clear btn btn-danger" data-action="clear">Clear</button>
										<input data-action="save-jpg" type="submit" class="btn btn-primary" value="Enregistrer la signature"/>
										<a class="btn btn-primary" href="{{ path('bacloocrm_adispatcher') }}"><span>Fermer</span></a>
									</div>
								</div>
							</div>
						</div>
						<div class="hidden">{{ form_widget(form.signed, {'id':"sigdataid", 'attr' : { 'class' : 'form-control' } })  }}</div>
					</div>
				</div>
			{% endif %}
		{% endif %}

			<br><br>
		</div>
		{{ form_row(form._token) }}
	</form>
	<script type="text/javascript" src="{{ asset('js/signature_pad.umd.js') }}"></script>
	<script type="text/javascript" src="{{ asset('js/app.js') }}"></script>

	<script>
  $( function() {
	$( ".datepicker" ).datepicker({
		dateFormat: 'dd/mm/yy',
		firstDay:1
	});
  } );
</script>

	<script>
    // init,configure dropzone
    Dropzone.autoDiscover = false;

    var dropzone_default = new Dropzone(".dropzone", {
        url: '{{ path('bacloocrm_dropzoneimage', {'codecontrat':bondepartid, 'type':'bd'}) }}',
        maxFiles: 4,
        dictMaxFilesExceeded: 'Only 4 Image can be uploaded',

        acceptedFiles: '.jpg,.jpeg,.png,.bmp',
        maxFilesize: 5,  // in Mb
		resizeWidth: 980,
        addRemoveLinks: true,
        renameFile: function (file) {
		let newName = new Date().getTime() + '_' + file.name;
		return newName;
		},
        init: function () {
            this.on("maxfilesexceeded", function(file) {
                this.removeFile(file);
            });
            this.on("sending", function(file, xhr, formData) {
                // send additional data with the file as POST data if needed.
                // formData.append("key", "value");
            });
            this.on("success", function() {
                if (this.getQueuedFiles().length == 0 && this.getUploadingFiles().length == 0) {
                    location.reload();
                }
            });
        }
    });
</script>

	<script type="text/javascript" src="{{ asset('js/bootstrap-clockpicker.min.js') }}"></script>
	<script type="text/javascript">
$('.clockpicker').clockpicker({
    placement: 'bottom',
    align: 'left',
    autoclose: true,
    'default': 'now'
});
</script>
	<script type="text/javascript">
$('.clockpicker').clockpicker()
	.find('input').change(function(){
		console.log(this.value);
	});
var input = $('#single-input').clockpicker({
	placement: 'bottom',
	align: 'left',
	autoclose: true,
	'default': 'now'
});

$('.clockpicker-with-callbacks').clockpicker({
		donetext: 'Done',
		init: function() {
			console.log("colorpicker initiated");
		},
		beforeShow: function() {
			console.log("before show");
		},
		afterShow: function() {
			console.log("after show");
		},
		beforeHide: function() {
			console.log("before hide");
		},
		afterHide: function() {
			console.log("after hide");
		},
		beforeHourSelect: function() {
			console.log("before hour selected");
		},
		afterHourSelect: function() {
			console.log("after hour selected");
		},
		beforeDone: function() {
			console.log("before done");
		},
		afterDone: function() {
			console.log("after done");
		}
	})
	.find('input').change(function(){
		console.log(this.value);
	});

// Manually toggle to the minutes view
$('#check-minutes').click(function(e){
	// Have to stop propagation here
	e.stopPropagation();
	input.clockpicker('show')
			.clockpicker('toggleView', 'minutes');
});
if (/mobile/i.test(navigator.userAgent)) {
	$('input[name=name]').prop('readOnly', true);
}
</script>
{% endblock %}