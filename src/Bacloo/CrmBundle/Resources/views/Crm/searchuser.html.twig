{% extends "BaclooCrmBundle::layout.html.twig" %}
{% block body %}

<div class="panel panel-default">
	<div class="panel-heading">
		<h3 class="panel-title">
			<h3>Rechercher des collègues avec qui partager des fiches</h3>
		</h3>
	</div>
	<div class="panel-body">
		<div class="col-md-12">
			{% if mode == 'bigsearch' %}
					{% if resultats is defined %}	
						{% if resultats == 'begin' %}
						<form class="form-horizontal" action="{{ path('bacloocrm_searchuser', {'mode': mode}) }}" method="post" {{form_enctype(form) }}>
							{# Les erreurs générales du formulaire. #}
										
										<div class="form-group">
										  <div class="controls">
											  <div class="col-md-12">
												<div class="input-group">	
													<span class="input-group-addon large">Nom d'utilisateur</span>
												{{  form_widget(form.username, { 'attr' : { 'class' : 'form-control'} })  }}
												</div>						
											  </div>
										  </div>
										</div>										
										<div class="form-group">
										  <div class="controls">
											  <div class="col-md-12">
												<div class="input-group">	
													<span class="input-group-addon large">Nom</span>
												{{  form_widget(form.nom, { 'attr' : { 'class' : 'form-control'} })  }}
												</div>						
											  </div>
										  </div>
										</div>										
										<div class="form-group">
										  <div class="controls">
											  <div class="col-md-12">
												<div class="input-group">	
													<span class="input-group-addon large">Activité</span>
												{{  form_widget(form.activite, { 'attr' : { 'class' : 'form-control'} })  }}
												</div>						
											  </div>
										  </div>
										</div>										
										<div class="form-group">
										  <div class="controls">
											  <div class="col-md-12">
												<div class="input-group">	
													<span class="input-group-addon large">Môt clé</span>
												{{  form_widget(form.tags, { 'attr' : { 'class' : 'form-control'} })  }}
												</div>						
											  </div>
										  </div>
										</div>										
										<div class="form-group">
										  <div class="controls">
											  <div class="col-md-12">
												<div class="input-group">	
													<span class="input-group-addon large">Activité visée</span>
												{{  form_widget(form.actvise, { 'attr' : { 'class' : 'form-control'} })  }}
												</div>						
											  </div>
										  </div>
										</div>	
									
							<center>
							<br>
								{{ form_row(form._token) }}
								<input type="submit" class="btn btn-primary" />
							</center>
						</form>
							<br><br><br>
						{% elseif resultats == 'rien' %}							
						<form class="form-horizontal" action="{{ path('bacloocrm_searchuser', {'mode': mode}) }}" method="post" {{form_enctype(form) }}>
							{# Les erreurs générales du formulaire. #}																			
										<div class="form-group">
										  <div class="controls">
											  <div class="col-md-12">
												<div class="input-group">	
													<span class="input-group-addon large">Nom d'utilisateur</span>
												{{  form_widget(form.username, { 'attr' : { 'class' : 'form-control'} })  }}
												</div>						
											  </div>
										  </div>
										</div>										
										<div class="form-group">
										  <div class="controls">
											  <div class="col-md-12">
												<div class="input-group">	
													<span class="input-group-addon large">Nom</span>
												{{  form_widget(form.nom, { 'attr' : { 'class' : 'form-control'} })  }}
												</div>						
											  </div>
										  </div>
										</div>										
										<div class="form-group">
										  <div class="controls">
											  <div class="col-md-12">
												<div class="input-group">	
													<span class="input-group-addon large">Activité</span>
												{{  form_widget(form.activite, { 'attr' : { 'class' : 'form-control'} })  }}
												</div>						
											  </div>
										  </div>
										</div>										
										<div class="form-group">
										  <div class="controls">
											  <div class="col-md-12">
												<div class="input-group">	
													<span class="input-group-addon large">Môt clé</span>
												{{  form_widget(form.tags, { 'attr' : { 'class' : 'form-control'} })  }}
												</div>						
											  </div>
										  </div>
										</div>										
										<div class="form-group">
										  <div class="controls">
											  <div class="col-md-12">
												<div class="input-group">	
													<span class="input-group-addon large">Activité visée</span>
												{{  form_widget(form.actvise, { 'attr' : { 'class' : 'form-control'} })  }}
												</div>						
											  </div>
										  </div>
										</div>		
														
							<center>
							<br>
								{{ form_row(form._token) }}
								<input type="submit" class="btn btn-primary" />
							</center>
						</form>
							<br><br>				
							<center><h4>Aucun nom d'utilisateur ne correspond à votre recherche</h4></center>																	
						{% elseif id is defined  %}
							<form class="form-horizontal" action="{{ path('bacloocrm_searchuser', {'mode': mode}) }}" method="post" {{form_enctype(form) }}>
								{# Les erreurs générales du formulaire. #}
						
										
										<div class="form-group">
										  <div class="controls">
											  <div class="col-md-12">
												<div class="input-group">	
													<span class="input-group-addon large">Nom d'utilisateur</span>
												{{  form_widget(form.username, { 'attr' : { 'class' : 'form-control'} })  }}
												</div>						
											  </div>
										  </div>
										</div>										
										<div class="form-group">
										  <div class="controls">
											  <div class="col-md-12">
												<div class="input-group">	
													<span class="input-group-addon large">Nom</span>
												{{  form_widget(form.nom, { 'attr' : { 'class' : 'form-control'} })  }}
												</div>						
											  </div>
										  </div>
										</div>										
										<div class="form-group">
										  <div class="controls">
											  <div class="col-md-12">
												<div class="input-group">	
													<span class="input-group-addon large">Activité</span>
												{{  form_widget(form.activite, { 'attr' : { 'class' : 'form-control'} })  }}
												</div>						
											  </div>
										  </div>
										</div>										
										<div class="form-group">
										  <div class="controls">
											  <div class="col-md-12">
												<div class="input-group">	
													<span class="input-group-addon large">Môt clé</span>
												{{  form_widget(form.tags, { 'attr' : { 'class' : 'form-control'} })  }}
												</div>						
											  </div>
										  </div>
										</div>										
										<div class="form-group">
										  <div class="controls">
											  <div class="col-md-12">
												<div class="input-group">	
													<span class="input-group-addon large">Activité visée</span>
												{{  form_widget(form.actvise, { 'attr' : { 'class' : 'form-control'} })  }}
												</div>						
											  </div>
										  </div>
										</div>		
										
								<center>
								<br>
									{{ form_row(form._token) }}
									<input type="submit" class="btn btn-primary" />
									<br><br>
								</center>
							</form>
							<div class="row clearfix">
								<div class="col-md-12">
										<table id="bacloo2" class="table table-bordered">
										<thead>
											<tr id="dibac">
												<th>
													Nom d'utilisateur
												</th>								
												<th>
													Nom
												</th>
												<th>
													Prénom
												</th>
												<th>
													Activité
												</th>
												<th>
													Secteur visé
												</th>
												<th>
													Mots clés
												</th>
												<th>
													Description de sa recherche
												</th>
												<th>
													note
												</th>
												<th>
												</th>	
												<th>
												</th>							
											</tr>
										</thead>				
								{% for res in resultats %}
									{% if res.username != user %}
											<tr>
												<td>
												{{ res.username }}
												</td>
												<td>
												{{ res.nom }}
												</td>
												<td>
												{{ res.prenom }}
												</td>
												<td>
												{{ res.activite }}
												</td>
												<td>
												{{ res.actvise }}
												</td>
												<td>
												{{ res.tags }}
												</td>
												<td>
												{{ res.descRech }}
												</td>
												<td>
												{{ res.note }}
												</td>
												<td class="col-md-1">
													<a class="btn btn-success" href="{{ path('bacloocrm_sendmessage', {'vemail': res.username, 'type': 'favoris', 'rais': '0' }) }}"><span class="glyphicon glyphicon-envelope" aria-hidden="true"></span>  Contacter cet Utilisateur </a>
												</td>
												<td class="col-md-1">
												{% if partenaires is not empty %}
													{% for part in partenaires %}
														{% if res.username == part.partpotUsername %}			
																{% if part.partenaire == '1' %}
																	<span class="glyphicon glyphicon-hourglass" aria-hidden="true"></span> En attente de réponse
																{% elseif part.partenaire == 'ok' %}
																	<span class="glyphicon glyphicon-ok" aria-hidden="true"></span> Partenaire
																{% elseif part.partenaire == 'nok' %}
																	<span class="glyphicon glyphicon-ok" aria-hidden="true"></span> Non Disponible
																{% else %}
																	<a class="btn btn-primary" href="{{ path('bacloocrm_askpart', {'id': part.id, 'partpotid': part.partpotid, 'modepart': 'parpot'}) }}"><span class="glyphicon glyphicon-envelope" aria-hidden="true"></span>  Demande de partenariat</a>				
																{% endif %}
														{% else %}
															<a class="btn btn-primary" href="{{ path('bacloocrm_askpart', {'id': res.id, 'partpotid': id, 'modepart': 'bigsearch'}) }}"><span class="glyphicon glyphicon-envelope" aria-hidden="true"></span>  Demande de partenariat</a>
														{% endif %}
													{% endfor %}
												{% elseif partenaires is not defined or partenaires is empty %}
														<a class="btn btn-primary" href="{{ path('bacloocrm_askpart', {'id': res.id, 'partpotid': id, 'modepart': 'bigsearch'}) }}"><span class="glyphicon glyphicon-envelope" aria-hidden="true"></span>  Demande de partenariat</a>
												{% endif %}
												</td>
											</tr>
									{% endif %}		
								{% endfor %}
									</table>
								</div>
							</div>
						{% endif %}
					{% elseif id is not defined %}
						<form class="form-horizontal" action="{{ path('bacloocrm_searchuser', {'mode': mode}) }}" method="post" {{form_enctype(form) }}>
						<fieldset>
							{# Les erreurs générales du formulaire. #}
										
										<div class="form-group">
										  <div class="controls">
											  <div class="col-md-12">
												<div class="input-group">	
													<span class="input-group-addon large">Nom d'utilisateur</span>
												{{  form_widget(form.username, { 'attr' : { 'class' : 'form-control'} })  }}
												</div>						
											  </div>
										  </div>
										</div>										
										<div class="form-group">
										  <div class="controls">
											  <div class="col-md-12">
												<div class="input-group">	
													<span class="input-group-addon large">Nom</span>
												{{  form_widget(form.nom, { 'attr' : { 'class' : 'form-control'} })  }}
												</div>						
											  </div>
										  </div>
										</div>										
										<div class="form-group">
										  <div class="controls">
											  <div class="col-md-12">
												<div class="input-group">	
													<span class="input-group-addon large">Activité</span>
												{{  form_widget(form.activite, { 'attr' : { 'class' : 'form-control'} })  }}
												</div>						
											  </div>
										  </div>
										</div>										
										<div class="form-group">
										  <div class="controls">
											  <div class="col-md-12">
												<div class="input-group">	
													<span class="input-group-addon large">Môt clé</span>
												{{  form_widget(form.tags, { 'attr' : { 'class' : 'form-control'} })  }}
												</div>						
											  </div>
										  </div>
										</div>										
										<div class="form-group">
										  <div class="controls">
											  <div class="col-md-12">
												<div class="input-group">	
													<span class="input-group-addon large">Activité visée</span>
												{{  form_widget(form.actvise, { 'attr' : { 'class' : 'form-control'} })  }}
												</div>						
											  </div>
										  </div>
										</div>			
									
							<center>
							<br>
								{{ form_row(form._token) }}
								<input type="submit" class="btn btn-primary" /><br>

						</fieldset>			
						</form>
						
					{% endif %}
			{% else %}	
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							 <a class="close" href="{{ path('bacloocrm_showfavoris') }}">×</a>			
								{% if mode == 'collegue' %}
									<h4 class="modal-title" id="myModalLabel">Ajouter un nouveau collègue à ma liste</h4>
								{% elseif mode == 'donner' %}
									<h4 class="modal-title" id="myModalLabel">Donner cette fiche à un autre utilisateur de Bacloo</h4>
								{% endif %}			
						</div>
						<div class="modal-body">
							<ul class="nav nav-pills nav-stacked">		
									{% if resultats is defined %}
										{% if mode == 'donner' %}
											<div class="alert alert-warning xs" role="alert">La copie n'inclut que la fiche administrative et les contacts.</div>
										{% endif %}	
										{% if resultats == 'rien' %}
										<form class="form-horizontal" action="{{ path('bacloocrm_searchuser', {'mode': mode}) }}" method="post" {{form_enctype(form) }}>
											{# Les erreurs générales du formulaire. #}
														
														<div class="form-group">
														  <div class="controls">
															  <div class="col-md-12">
																<div class="input-group">	
																	<span class="input-group-addon large">Nom d'utilisateur</span>
																{{  form_widget(form.username, { 'attr' : { 'class' : 'form-control', 'placeholder' : 'Nom d\'utilisateur valide' } })  }}
																</div>						
															  </div>
														  </div>
														</div>	
													
											<center>
											<br>
												{{ form_row(form._token) }}
												<input type="submit" class="btn btn-primary" />
											</center>
										</form>
											<br><br>				
											<center><h4>Aucun nom d'utilisateur ne correspond à votre recherche</h4></center>
										{% elseif resultats == 'begin' %}
										<form class="form-horizontal" action="{{ path('bacloocrm_searchuser', {'mode': mode}) }}" method="post" {{form_enctype(form) }}>
											{# Les erreurs générales du formulaire. #}
														
														<div class="form-group">
														  <div class="controls">
															  <div class="col-md-12">
																<div class="input-group">	
																	<span class="input-group-addon large">Nom d'utilisateur</span>
																{{  form_widget(form.username, { 'attr' : { 'class' : 'form-control' } })  }}
																</div>						
															  </div>
														  </div>
														</div>	
													
											<center>
											<br>
												{{ form_row(form._token) }}
												<input type="submit" class="btn btn-primary" />
											</center>
										</form>
											<br><br><br>
																
										
										{% elseif id is defined  %}
											<form class="form-horizontal" action="{{ path('bacloocrm_searchuser', {'mode': mode}) }}" method="post" {{form_enctype(form) }}>
												{# Les erreurs générales du formulaire. #}
										
															<div class="form-group">
															  <div class="controls">
																  <div class="col-md-12">
																	<div class="input-group">	
																		<span class="input-group-addon large">Nom d'utilisateur</span>
																	{{  form_widget(form.username, { 'attr' : { 'class' : 'form-control' } })  }}
																	</div>						
																  </div>
															  </div>
															</div>		
														
												<center>
												<br>
													{{ form_row(form._token) }}
													<input type="submit" class="btn btn-primary" />
													<br><br>
												</center>
											</form>
											<div class="row clearfix">
												<div class="col-md-12">
														<table id="bacloo2" class="table table-bordered">
														<thead>
															<tr id="dibac">
																<th>
																	Nom d'utilisateur
																</th>								
																<th>
																	Nom
																</th>
																<th>
																	Prénom
																</th>
																<th>
																</th>							
															</tr>
														</thead>				
												{% for res in resultats %}
														<tr>
															<td>
															{{ res.username }}
															</td>
															<td>
															{{ res.nom }}
															</td>
															<td>
															{{ res.prenom }}
															</td>
															<td>
															{% if mode == 'collegue' %}
																<a type="button" class="btn btn-warning btn-xl" href="{{ path('bacloocrm_ajouterfavoris', {'favuserid':res.id ?:0} ) }}">Ajouter comme collègue</span></a>
															{% elseif mode == 'donner' %}
																<a type="button" class="btn btn-warning btn-xl" href="{{ path('bacloocrm_donnerfiche', {'ficheid':idfiche, 'username':res.username ?:0 } ) }}">Donner la fiche</a>
															{% endif %}
															</td>
														</tr>								
												{% endfor %}
													</table>
												</div>
											</div>
										{% endif %}
									{% elseif id is not defined %}4
										<form class="form-horizontal" action="{{ path('bacloocrm_searchuser', {'mode': mode}) }}" method="post" {{form_enctype(form) }}>
										<fieldset>
											{# Les erreurs générales du formulaire. #}

														<div class="form-group">
														  <div class="controls">
															  <div class="col-md-12">
																<div class="input-group">	
																	<span class="input-group-addon large">Nom d'utilisateur</span>
																{{  form_widget(form.username, { 'attr' : { 'class' : 'form-control' } })  }}
																</div>						
															  </div>
														  </div>
														</div>				
													
											<center>
											<br>
												{{ form_row(form._token) }}
												<input type="submit" class="btn btn-primary" /><br>

										</fieldset>			
										</form>
										{% endif %}
											{% if resultats == 'ajoutok' %}6
										<form class="form-horizontal" action="{{ path('bacloocrm_searchuser', {'mode': mode}) }}" method="post" {{form_enctype(form) }}>
										<fieldset>
											{# Les erreurs générales du formulaire. #}

														<div class="form-group">
														  <div class="controls">
															  <div class="col-md-12">
																<div class="input-group">	
																	<span class="input-group-addon large">Nom d'utilisateur</span>
																{{  form_widget(form.username, { 'attr' : { 'class' : 'form-control' } })  }}
																</div>						
															  </div>
														  </div>
														</div>				
													
											<center>
											<br>
												{{ form_row(form._token) }}
												<input type="submit" class="btn btn-primary" /><br>

										</fieldset>			
										</form>					
											<h3>L'utilisateur {{ newfavusername }} a bien été rajouté à votre liste de collegues </h3>


									{% endif %}

							</ul>
						</div>
						<div class="modal-footer">

												<a class="btn btn-primary" href="{{ path('bacloocrm_showfavoris') }}"><span>Fermer</span></a>
						</div>
					</div>					
				</div>
			{% endif %}
		</div>
	</div>
</div>


	
{% endblock %}