{# src/Bacloo/CrmBundle/Resources/views/Blog/search.html.twig #}
{% extends "BaclooCrmBundle::layout.html.twig" %}
{% block body %}
<div class="panel panel-default">
	<div class="panel-heading">
		<h3 class="panel-title">
			<h3>Planning des locations</h3>
		</h3>
	</div>
	<div class="panel-body">
		  <div class="sidebar-search">
			  <div class="input-group custom-search-form">
				  <input type="text" id="search" class="form-control" placeholder="Raison Sociale...">
				  <div id="match"></div>
			  </div>
			  <!-- /input-group -->
		  </div>
		  <div class="nav" id="matchList">

		  </div>
	</div>	

	<script type="text/javascript">

		jQuery(document).ready(function(){
		var searchRequest = null;
		 $("#search").on('keyup', function() { // everytime keyup event
				 var input = $(this).val(); // We take the input value
				 if ( input.length >= 2 ) { // Minimum characters = 2 (you can change)
						 $('#match').html('<img style="width:100px;height:100px;" src="https://media.giphy.com/media/3oEjI6SIIHBdRxXI40/giphy.gif" />'); // Loader icon apprears in the <div id="match"></div>
						 var data = {input: input}; // We pass input argument in Ajax
						 $.ajax({
								 type: "POST",
								 url: "{{ path('ajax_autocomplete_countries') }}", // call the php file ajax/tuto-autocomplete.php (check the routine we defined)
								 data: data, // Send dataFields var
								 dataType: 'json', // json method
								 timeout: 3000 * 10,
								 success: function(response){ // If success
										 $('#match').html(response.countryList); // Return data (UL list) and insert it in the <div id="match"></div>
										 $('#matchList li').on('click', function() { // When click on an element in the list
												 $('#search').val($(this).text()); // Update the field with the new element
												 $('#match').text(''); // Clear the <div id="match"></div>
										 });     
								 },
								 error: function() { // if error
										 $('#match').text('Problem!');
								 }
						 });
				 } else {
						 $('#match').text(''); // If less than 2 characters, clear the <div id="match"></div>
				 }
		 });
	 });
	</script>
{% endblock %}
